<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <title>COVID Data</title>
</head>

<body>
    <div class="container">
    <section id="search-section" class="section">
      <div class="container">
      <form id="covid-form"></form>
          <label for="name">Search for a State: </label><br>
          <!--States drop down-->
          <select id='states'>
              <option value="AK">Alaska</option>
              <option value="AL">Alabama</option>
              <option value="AR">Arkansas</option>
              <option value="AS">Alaska</option>
              <option value="AZ">Arizona</option>
              <option value="CA">California</option>
              <option value="CO">Colorado</option>
              <option value="CT">Connecticut</option>
              <option value="DE">Delaware</option>
              <option value="FL">Florida</option>
              <option value="GA">Georgia</option>
              <option value="GU">Guam</option>
              <option value="HI">Hawaii</option>
              <option value="IA">Iowa</option>
              <option value="ID">Idaho</option>
              <option value="IL">Illinois</option>
              <option value="IN">Indiana</option>
              <option value="KS">Kansas</option>
              <option value="KY">Kentucky</option>
              <option value="LA">Louisiana</option>
              <option value="MA">Massachusetts</option>
              <option value="MD">Maryland</option>
              <option value="ME">Maine</option>
              <option value="MI">Michigan</option>
              <option value="MN">Minnesota</option>
              <option value="MO">Missouri</option>
              <option value="MP">Northern Mariana Islands</option>
              <option value="MS">Mississippi</option>
              <option value="MT">Montana</option>
              <option value="NC">North Carolina</option>
              <option value="ND">North Dakota</option>
              <option value="NE">Nebraska</option>
              <option value="NH">New Hampshire</option>
              <option value="NJ">New Jersey</option>
              <option value="NM">New Mexico</option>
              <option value="NV">Nevada</option>
              <option value="NY">New York</option>
              <option value="OH">Ohio</option>
              <option value="OK">Oklahoma</option>
              <option value="OR">Oregon</option>
              <option value="PA">Pennsylvania</option>
              <option value="RI">Rhode Island</option>
              <option value="SC">South Carolina</option>
              <option value="SD">South Dakota</option>
              <option value="TN">Tennessee</option>
              <option value="TX">Texas</option>
              <option value="UT">Utah</option>
              <option value="VA">Virgina</option>
              <option value="VI">Virgina Islands</option>
              <option value="VT">Vermont</option>
              <option value="WA">Washington</option>
              <option value="WI">Wisconsin</option>
              <option value="WV">West Virgina</option>
              <option value="WY">Wyoming</option>
               </select>
    
            <!--<input id="state-input" type="text" name="State" placeholder="Enter 2 letters" > --> 
            <link rel="stylesheet" href="style.css"></link>
            <input id="add-state" type="submit" value="Search">
        </form>
            </div>
        </section>

        <section id="state-section" class="section">
            <div class="columns">
                <div class="column box">
                <!-- Retrieved data will be dumped here -->
                <div class="date"></div>
                <div class="state"></div>
                <div class="positive"></div>
                <div class="death"></div>
                <div class="positiveIncrease"></div>
                <div class="active"></div>
                <div class="recovered"></div>
            </div>
        </section>
        <section id="world-section" class="section">
           
            <div class="columns">
                <!-- HTML for the "COUNTRY data" part of the page goes here -->
                <!-- for the world -->
                <!-- <div id = "worldData"></div> -->
<<<<<<< HEAD
                <div class="country" population= 331002651 id="United States of America" data-value="USA"></div>
                <div class="country" population= 25499884 id="Australia" data-value="AUS"></div>
                <div class="country" population= 37742154 id="Canada" data-value="CAN"></div>
                <div class="country" population= 65273511 id="France" data-value="FRA"></div>
                <div class="country" population= 67886011 id="United Kingdom" data-value="GBR"></div>
=======
                <div class="country box column is-one-fifth" id="United States of America" data-value="USA"></div>
                <div class="country box column is-one-fifth" id="Australia" data-value="AUS"></div>
                <div class="country box column is-one-fifth" id="Canada" data-value="CAN"></div>
                <div class="country box column is-one-fifth" id="France" data-value="FRA"></div>
                <div class="country box column is-one-fifth" id="United Kingdom" data-value="GBR"></div>
>>>>>>> main
            </div>
        </section>
    </div>

    <!-- Load jQuery and Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>

    <script type="text/javascript">

        $( window ).on( "load", firstCovid );
        

        function firstCovid() {
            //set intial state to Ohio
            let stateInput = "OH";
            //load the last stored state from local storage 
            let stateStore = JSON.parse(localStorage.getItem("lastSelectedState"));
            //if there is a stored state use it to update the initial state 
            if (stateStore !== null) {
                stateInput = stateStore;
            };
            //Call covidtracking.com API with the State selected by the user 
            var queryURL = "https://api.covidtracking.com/v1/states/" + stateInput + "/current.json";

            $.ajax({
                url: queryURL,
                method: "GET"
            }).then(function (response) {

                var activekeep = parseInt(response.positive) - parseInt(response.recovered) - parseInt(response.death);
                console.log("ActiveKeep = " + activekeep);
                $(".state").html("<h1>" + response.state + " COVID Details " + response.date + "</h1>");
                $(".positive").text("Total Cases: " + response.positive);
                $(".death").text("Total Deaths: " + response.death);
                $(".positiveIncrease").text("New Cases: " + response.positiveIncrease);
                $(".active").text("Active Cases: " + activekeep);
                $(".recovered").text("Recovered: " + response.recovered);
                
            });

        };




        
        $("#add-state").on("click", function (event) {
            // event.preventDefault() prevents the form from trying to submit itself.

            event.preventDefault();

            // This line will grab the text from the input box
            var stateInput = $("#states").val().trim();
            console.log(stateInput);
            
            //Store the last viewed State to localstorage
            localStorage.setItem("lastSelectedState", JSON.stringify(stateInput));
            
            //Call covidtracking.com API with the State selected by the user 
            var queryURL = "https://api.covidtracking.com/v1/states/" + stateInput + "/current.json";

            $.ajax({
                url: queryURL,
                method: "GET"
            }).then(function (response) {

                var activekeep = parseInt(response.positive) - parseInt(response.recovered) - parseInt(response.death);
                console.log("ActiveKeep = " + activekeep);
                $(".state").html("<h1>" + response.state + " COVID Details " + response.date + "</h1>");
                $(".positive").text("Total Cases: " + response.positive);
                $(".death").text("Total Deaths: " + response.death);
                $(".positiveIncrease").text("New Cases: " + response.positiveIncrease);
                $(".active").text("Active Cases: " + activekeep);
                $(".recovered").text("Recovered: " + response.recovered);

                // Log the queryURL
                console.log(queryURL);
            });

        });


        // World part
        console.log(moment().format());
        function returnDate() {
            // var codeObject = {""}

            var dateString = moment().format();
            var currentDate = "";
            for (let i = 0; i < dateString.indexOf("T"); i++) {
                currentDate += dateString[i];
            }
            return currentDate;
        }
        var currentDate = returnDate();
        var countries = ["United States of America", "Australia", "Canada", "France", "United Kingdom"]
        var countryPopulation = [
            {
            country: "United States of America",
            population: 331002651,
            code:"USA"
        },
            {
            country: "Australia",
            population: 25499884,
            code:"AUS"
        },
            {
            country: "Canada",
            population: 37742154,
            code:"CAN"
        },
            {
            country: "France",
            population: 65273511,
            code:"FRA"
        },
            {
            country: "United Kingdom",
            population: 67886011,
            code:"GBR"
        }
    ];



        // var countryPopulation = {
        //     country:
        //     {
        //     name:"United States of America",
        //     population: 331002651,
        //     code:"USA"
        // },
        //     {
        //     country: "Australia",
        //     population: 25499884,
        //     code:"AUS"
        // },
        //     {
        //     country: "Canada",
        //     population: 37742154,
        //     code:"CAN"
        // },
        //     {
        //     country: "France",
        //     population: 65273511,
        //     code:"FRA"
        // },
        //     {
        //     country: "United Kingdom",
        //     population: 67886011,
        //     code:"GBR"
        // }
        // };
        // var countryObject = [{ "Australia": "AUS" },]
        console.log(currentDate)


        function showWorldData() {
            var allCountry = $(".country");
            allCountry.each(function () {
                //   allCountry.forEach(function(){
                var element = $(this);
                // console.log(this)
                var countryCode = element.attr("data-value");
                var countryName = element.attr("ID");
                console.log(countryName);
                var queryURl = "https://covidtrackerapi.bsg.ox.ac.uk/api/v2/stringency/actions/" + countryCode + "/" + currentDate;

                $.ajax({
                    url: queryURl,
                    method: "GET"
                }).then(function (response) {
                    console.log(response);
                    console.dir(response.stringencyData.confirmed)
                    console.log(typeof response.stringencyData.confirmed)

                    // var totalConfirmed = $("<p></p>").text(`${countryName} total case : ${response.stringencyData.confirmed}.`);
                    // var totalDeath = $("<p></p>").text(`${countryName} total death : ${response.stringencyData.death}.`);
                    var totalConfirmed = $("<p></p>").text(`Total case : ${response.stringencyData.confirmed}`);
                    var totalPer10k = $("<p></p>").text(`Confirmed case per 10k : ${(response.stringencyData.confirmed /element.attr("population")*10000).toFixed(0)}`);
                    var totalDeath = $("<p></p>").text(`Total death : ${response.stringencyData.deaths}`);
                    var totalDeathPer10K = $("<p></p>").text(`Death per 10k: ${(response.stringencyData.deaths /element.attr("population")*10000).toFixed(2)}`);

                    element.append($("<h1>").text(countryName + ":"));
                    element.append(totalConfirmed);
                    element.append(totalDeath);
                    element.append(totalPer10k);
                    element.append(totalDeathPer10K);

                    element.append($("<br>"));


                })

            })
            // var queryURl = "https://covidtrackerapi.bsg.ox.ac.uk/api/v2/stringency/actions/"+countries[0]+"/" +currentDate


        }
        showWorldData();

        // https://covidtrackerapi.bsg.ox.ac.uk/api/v2/stringency/actions/USA/2020-11-16

    </script>



</body>

</html>